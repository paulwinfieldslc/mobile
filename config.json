{"id":"e06aa69e-f7f0-4c5a-a9eb-4b18e68c887c","version":"0.79.1","icon":"other","splash":"other","splashdata":{"bg":"#222e66","img":"SLCLogo.png"},"settings":{"router":{"mode":"single","animation":"off"},"theme":"default","push-notifications":{"android":{"enabled":false},"ios":{"enabled":false},"wp":{"enabled":false}},"provisioning":{"enabled":false,"manifest":"","poll":2,"manual":false,"wifionly":true},"crashReporting":{"enabled":false,"androidEnabled":false,"iosEnabled":false,"splunkAndroidApiKey":"","splunkIosApiKey":"","splunkExtraData":""},"kioskMode":{"enabled":false},"logging":{"enabled":false,"bufferFrequency":100,"defaultRootLogLevel":"error","defaultMaxFileSizeKilobyte":1000,"defaultMaxFiles":5,"appEnabled":true,"appUseDefault":true,"appRootLogLevel":"error","appMaxFileSizeKilobyte":1000,"appMaxFiles":5,"clientEnabled":true,"clientUseDefault":true,"clientRootLogLevel":"error","clientMaxFileSizeKilobyte":1000,"clientMaxFiles":5,"nativeEnabled":true,"nativeUseDefault":true,"nativeRootLogLevel":"error","nativeMaxFileSizeKilobyte":1000,"nativeMaxFiles":5},"loading-message":true,"minimise-on-back-button":true,"plugins":{"builtIn":{"cordova-plugin-whitelist@1.2.2":{"override":true,"used":true,"enabled":true},"cordova-plugin-battery-status@1.1.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-console@1.0.3":{"override":false,"used":true,"enabled":true},"cordova-plugin-contacts@2.1.0":{"override":false,"used":false,"enabled":false},"cordova-plugin-device@1.1.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-device-motion@1.2.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-device-orientation@1.0.3":{"override":false,"used":false,"enabled":false},"cordova-plugin-file@4.2.0":{"override":false,"used":true,"enabled":true},"cordova-plugin-geolocation@2.2.0":{"override":true,"used":false,"enabled":true},"cordova-plugin-globalization@1.0.3":{"override":false,"used":true,"enabled":true},"commontime-cordova-plugin-inappbrowser@1.6.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-network-information@1.2.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-splashscreen@3.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-vibration@2.1.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-statusbar@1.0.1":{"override":false,"used":true,"enabled":true},"cordova-plugin-camera@2.3.1":{"override":true,"used":false,"enabled":true},"phonegap-plugin-barcodescanner@6.0.4":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.thumbnail@1.4.8":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.fileimporter@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.beacon@1.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.11":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.audio@0.9.10":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.media-properties@1.2.11":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.splitscreen@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.preferences@1.0.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.authentication@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.urlhandler@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.securesettings@1.0.2":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.geofence@0.5.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-transfer@1.5.5":{"override":true,"used":false,"enabled":true},"com.commontime.cordova.public.provisioning@0.0.13":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.insomnia@0.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.splunk-mint@1.0.3":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.kiosk@1.0.11":{"override":false,"used":false,"enabled":false},"cordova-android-movetasktoback@0.1.3":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.logging@1.0.23":{"override":false,"used":true,"enabled":true},"cordova-plugin-email-composer":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.public.messaging@0.0.41":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.logging@1.0.24":{"override":false,"used":true,"enabled":true},"cordova-plugin-email":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.public.messaging@0.0.44":{"override":false,"used":false,"enabled":false}},"customPlugins":{"com.commontime.cordova.securesettings":{"id":"com.commontime.cordova.securesettings","spec":"1.0.7","name":"com.commontime.cordova.securesettings","description":"Secure Settings","version":"1.0.7"}}},"mapping":{"googleMapsAPIKey":"AIzaSyAJ5CO4zuiE1AL_M-uUoioigScCRiUjKoQ"}},"language":{"defaultLocale":"en_GB","initialLanguage":"","useDeviceLocale":true},"metadata":{"applicationkey":"roads.application","apiaddress":"https://mroadslive.southlanarkshire.gov.uk/api/","apisyncinterval":"300000","RequestUnauthorisedActionFlow":"UnauthorisedHandler"},"name":"SLCRoadsGang","packageId":"gov.southlanarkshire.mobile.roadsgang","schemaVersion":22,"minimumStudioVersion":"3.1.0","pages":[{"start":true,"name":"Login","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"d595d57c-f36c-4724-bc2d-8b753f6c2f8e","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.page = \"Login\";\n\nconsole.log(\"Login page loaded\");\nif (!cti.store.variables.apiaddress) {\n  cti.store.variables.apiaddress = cti.store.schema.metadata.apiaddress;\n  application.logEvent(\"Initialise API address > \" + cti.store.variables.apiaddress, \"info\");\n}\n"},"_auto_id_":"b9d9c1c6-c85b-4f11-ae5a-ac0681d57cc7"}]}],"content":[{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"menuLogin","type":"component","item-type":"web-component","content":[{"name":"btnGoSupport","type":"button","item-type":"nav-button","_auto_id_":"5c3fb769-6d78-4929-8712-b1690d4809b2","extends":{"type":"button","item-type":"button"},"content":"Support","actions":[{"event":"click","type":"go-to-page","data":{"name":"Support","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-question-circle"},{"name":"btnGoSettings","type":"button","item-type":"nav-button","_auto_id_":"11996b96-9d1f-4fe9-a37e-a635196cd771","extends":{"type":"button","item-type":"button"},"content":"Settings","actions":[{"event":"click","type":"go-to-page","data":{"name":"Settings","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-cog"}],"componentId":"e677c899-4008-4d70-8601-452873cad5bc","_auto_id_":"5c02be61-4966-4f06-a461-37414b377a83","attributes":{},"actions":[],"expressions":{}},{"name":"Loader_1","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"4b8eb2db-2361-4018-be56-96569eb1a53c","attributes":{"message":"Logging in, one moment..."},"actions":[],"expressions":{}},{"name":"logoImage","type":"media","item-type":"image-viewer","_auto_id_":"8f614660-db00-4537-a4ed-f9eb87b07aa0","scaleImage":true,"maxWidth":200,"maxHeight":200,"fileName":"SLC-logo 1 3.svg","expressions":{},"classes":"logo-image","actions":[]},{"name":"htmlSummary","type":"content","item-type":"html","_auto_id_":"f8ea6427-a663-4987-b8eb-f0c1cbebf7f0","content":"<h3>Roads - Gang Application</h3>\n<p>Access to and use of this application and any data made available therein is for authorised personnel only and in strict accordance with the Council's Information Goverance guidelines. Access and use is audited.</p>\n<p class=\"version\">v. {{'$store.schema.version' | store}}</p>","expressions":{},"classes":"app-summary"},{"name":"username","type":"user-input","item-type":"text","_auto_id_":"daaff33e-6bb8-4b33-b447-d8a961c24a31","label":"","required":false,"multiline":false,"debounce":100,"placeholder":"enter your username","validators":[],"expressions":{},"message":"This is a required field","actions":[]},{"name":"password","type":"user-input","item-type":"password","_auto_id_":"eda83a18-3efe-4083-b651-591eb8642fc2","label":"","required":false,"left-icon":"fa-lock","message":"This is a required field","expressions":{},"placeholder":"enter your password","validators":[],"actions":[]},{"name":"btnLogin","type":"button","item-type":"button","_auto_id_":"15e4288c-1d8b-4600-ae48-86118b8d0165","content":"Login","theme":"default","left-icon":"fa-sign-in","actions":[{"event":"click","type":"inline-function","data":{"sync":false,"code":"if (!cti.store.pages.Login || !cti.store.pages.Login.username || !cti.store.pages.Login.password) {\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"ErrorMessage\", \"title\": \"Error\", \"text\": \"Please enter your username and password to proceed\" });\n\treturn false;\n}\n\nvar u = cti.store.pages.Login.username.toLowerCase();\ncti.store.variables.lastloginHash = btoa(u+cti.store.pages.Login.password);\n\napplication.startLoader('Logging in, please wait a moment...');\napplication.login(\"login\", \"LoginResponseHandler\");"},"_auto_id_":"d6986081-f74d-4a72-8c24-91b77d24c965","actions":[]}],"expressions":{"disabled":"$form.invalid"},"classes":"action-btn"}],"_auto_id_":"1d87e933-0a1e-4ee1-9355-728a1953edc8","expressions":{}}]},{"start":false,"name":"Menu","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"1bc20222-aa1d-416f-918f-b6bda646c91e","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"cti.store.variables.page = \"Menu\";\n\nconsole.log(\"Menu page loaded\");"},"_auto_id_":"aabb1371-d439-46e6-ad9f-336c95734421","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"title","type":"content","item-type":"title","content":"<h1>{{'$store.user.gangDescription' | store}} - Menu</h1>","_auto_id_":"2344f218-d4f6-4148-a5c6-e76bfd3921ee"}],"_auto_id_":"59a3076f-59aa-4680-b835-09ad1fb667dd"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"menu","type":"component","item-type":"web-component","content":[{"name":"btnSupport","type":"button","item-type":"nav-button","_auto_id_":"0271bf9b-89dd-4d25-801c-97d54c6d6599","extends":{"type":"button","item-type":"button"},"content":"Support","actions":[{"event":"click","type":"go-to-page","data":{"name":"Support","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-question-circle"},{"name":"btnSettings","type":"button","item-type":"nav-button","_auto_id_":"6677443b-b9fc-4aa4-a78b-dd5415734934","extends":{"type":"button","item-type":"button"},"content":"Settings","actions":[{"event":"click","type":"go-to-page","data":{"name":"Settings","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-cog"}],"componentId":"e677c899-4008-4d70-8601-452873cad5bc","_auto_id_":"8c890d2e-a8b5-4bbd-bdfb-8aad2787a194","attributes":{},"expressions":{}},{"name":"loader","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"7bc46717-91f0-493b-99be-58fb60a96194","attributes":{"message":"Updating data..."},"expressions":{},"actions":[]},{"name":"btnChangePassword","type":"button","item-type":"nav-button","_auto_id_":"66821042-9eb9-4d27-8237-1a9945dad34e","extends":{"type":"button","item-type":"button"},"content":"Change Password","actions":[{"event":"click","type":"go-to-page","data":{"name":"ChangeMyPassword","isConditional":false}}],"expressions":{},"theme":"default","classes":"menu-btn option-change-password"},{"name":"btnWorksOrders","type":"button","item-type":"button","_auto_id_":"ded16842-96a2-4ba2-ab5f-804bba9fd821","content":"Works Orders","theme":"default","expressions":{},"classes":"menu-btn option-work","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (cti.store.shift) {\n  application.goto(\"Shift\");\n}\nelse {\n  application.warningMessage(\"We're still waiting for shift information for your gang from head office. Please wait a moment.\");\n}"},"_auto_id_":"82332639-9932-461c-b257-6baa5da7cbf0","actions":[]}]},{"name":"btnLogout","type":"button","item-type":"button","_auto_id_":"8b717333-313f-497f-8045-46671b46edfe","content":"Log out","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"application.logout();"},"_auto_id_":"26c061ff-2677-46c1-a94f-12f6f5fe7db9"}],"classes":"menu-btn option-logout"}],"_auto_id_":"2b87f76a-a353-4a82-b7bf-e448813bd222","expressions":{},"classes":"menuScroll"}]},{"start":false,"name":"Settings","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"60afffd4-4f2b-41c4-8551-eaffb300997d","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"cti.store.variables.page = \"Settings\";\n\nconsole.log(\"Settings page loaded\");\nif (!cti.store.pages.Settings) {\n  cti.store.pages.Settings = { }\n}\n\ncti.store.pages.Settings.apiaddress = cti.store.variables.apiaddress;\n"},"_auto_id_":"0ce515d5-0eea-49ee-9f10-4fa868373160","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnGoBack","type":"button","item-type":"button","_auto_id_":"63daa1f1-dcad-4b8c-801d-295d9705d1a9","content":"","theme":"default","left-icon":"fa-chevron-left","actions":[{"event":"click","type":"go-back","data":{},"_auto_id_":"ef2d0694-cf76-4b71-9caa-73be8063ad9c"}],"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h1>Settings</h1>","_auto_id_":"137afb4e-4f41-4640-b15a-3517f25f128f"}],"_auto_id_":"e41f82c8-d165-4ec6-b55b-ef81cac92da0"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"loader","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"84f819d0-41a5-4e13-ba1d-60708f2b652d","attributes":{"message":"Updating data..."},"expressions":{}},{"name":"apiaddress","type":"user-input","item-type":"text","_auto_id_":"dab78588-45fb-4cf4-9b8b-f1292c2cc8c3","label":"Server to connect to","required":false,"multiline":false,"debounce":250,"placeholder":"enter the API address that the app connects to","actions":[],"expressions":{},"validators":[],"left-icon":"fa-cloud"},{"name":"btnSave","type":"button","item-type":"button","_auto_id_":"503fff69-eab9-4c20-a4c0-0eb61f6fe873","content":"Save","theme":"default","expressions":{},"classes":"action-btn","left-icon":"fa-save","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.apiaddress = cti.store.pages.Settings.apiaddress || cti.store.schema.metadata.apiaddress;\napplication.logEvent(\"API address updated by user \" + cti.store.variables.apiaddress);\napplication.back();"},"_auto_id_":"d1ac15a8-05b8-42d3-a21d-a719ef02bd29"}]}],"_auto_id_":"d8e48247-0d14-495a-af68-58d86660cdcf","expressions":{},"classes":"menuScroll"}]},{"start":false,"name":"Support","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"7a7ee536-1246-4883-a73f-a381c6965e6f","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"cti.store.variables.page = \"Support\";\n\nconsole.log(\"Support page loaded\");"},"_auto_id_":"14ba7c23-e59e-4606-8cc9-d3a057e435ff","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnGoBack","type":"button","item-type":"button","_auto_id_":"a4c87506-58d3-4db0-9dbf-f06a8ba4283a","content":"","theme":"default","left-icon":"fa-chevron-left","actions":[{"event":"click","type":"go-back","data":{},"_auto_id_":"0ac58a28-fa6a-4c6b-8ab9-d3c678501ac0"}],"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h1>Support Information</h1>","_auto_id_":"e3f75895-3b96-49ed-933d-42ec40a2251a"}],"_auto_id_":"26d87844-1784-4bec-8123-6c66dfcb04af"},{"name":"static_1","type":"area","item-type":"static","_auto_id_":"58a93949-daa8-41c5-a385-8ba56b26b325","content":[{"name":"html_2","type":"content","item-type":"html","_auto_id_":"1ac898c2-b5a2-4f7f-9e8a-38f3a5d92fc4","content":"<div class=\"properties-and-values\">\n  <div class=\"property-name align-right\">Application</div>\n  <div class=\"property-value\">{{'$store.schema.name' | store}}</div>\n</div>\n\n<div class=\"properties-and-values\">\n  <div class=\"property-name align-right\">Version</div>\n  <div class=\"property-value\">{{'$store.schema.version' | store}}</div>\n</div>\n\n<div class=\"properties-and-values\">\n  <div class=\"property-name align-right\">Server</div>\n  <div class=\"property-value\">{{'$store.variables.apiaddress' | store}}</div>\n</div>\n"}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"list_1","type":"content","item-type":"list","_auto_id_":"1aa19540-afbd-4c9b-a674-cc1b9fe3051c","static":false,"model":"$store.log","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"html_1","type":"content","item-type":"html","_auto_id_":"104c719c-12eb-465a-b1a4-c434e45f732d","content":"<div class=\"list-card\">\n  <div class=\"column-icon indicator-{{$data.$item.type}}\">\n    <i class=\"fa fa-2x\"></i>\n  </div>\n  <div class=\"column column-20pc deemphasis\">\n  {{$data.$item.time}}\n  </div>\n  <div class=\"column emphasis\">\n  {{$data.$item.message}}\n  </div>\n</div>"}],"dataSource":"dynamic","actions":[],"paginationItemsPerPage":12,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPagesToDisplay":5,"expressions":{}}],"_auto_id_":"7988500e-ffcc-4353-8a20-054c37e22c03","expressions":{},"classes":"list-host"}]},{"start":false,"name":"ChangeMyPassword","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"245e35a9-ff74-4a2f-b1fa-8856051e324d","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"cti.store.variables.page = \"ChangeMyPassword\";\n\nconsole.log(\"ChangeMyPassword page loaded\");\ncti.utils.destroyPageData('ChangeMyPassword');"},"_auto_id_":"f76c51d1-bd16-4162-ac1e-95414bbd1f4d","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnGoBack","type":"button","item-type":"button","_auto_id_":"63ba36aa-0607-4af1-b6d2-b7493d97c6e9","content":"","theme":"default","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-back","data":{},"_auto_id_":"c8a13039-88f3-407f-ae23-5248e1c3e7c2"}]},{"name":"title","type":"content","item-type":"title","content":"<h1>Change Password</h1>","_auto_id_":"4155c41a-fee5-4e4d-82eb-83c9edd003db"}],"_auto_id_":"efc7c63e-00e8-4fc1-9241-45623dae8984"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"menu","type":"component","item-type":"web-component","content":[{"name":"btnSupport","type":"button","item-type":"nav-button","_auto_id_":"5f39c55c-ee23-488f-a12c-cf9d6f0906bb","extends":{"type":"button","item-type":"button"},"content":"Support","actions":[{"event":"click","type":"go-to-page","data":{"name":"Support","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-question-circle"}],"componentId":"e677c899-4008-4d70-8601-452873cad5bc","_auto_id_":"d812f2fb-f798-49cf-8cd1-defe32382f74","attributes":{},"expressions":{}},{"name":"txtCurrentPassword","type":"user-input","item-type":"password","_auto_id_":"090a98b7-4cc3-4eb9-a1bb-d6a580666533","label":"Current password","required":false,"left-icon":"fa-lock","message":"This is a required field","placeholder":"enter your current password","expressions":{}},{"name":"txtNewPassword","type":"user-input","item-type":"password","_auto_id_":"526810db-d34f-405f-8435-2a5b45beceae","label":"New password","required":false,"left-icon":"fa-lock","message":"This is a required field","expressions":{},"placeholder":"enter your new password"},{"name":"txtConfirmPassword","type":"user-input","item-type":"password","_auto_id_":"4519682c-065c-4a25-b61b-b2a649b90210","label":"Confirm new password","required":false,"left-icon":"fa-lock","message":"This is a required field","placeholder":"confirm your new password","expressions":{}},{"name":"loader","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"bb7dc51e-29e9-46f4-8a49-1c48af92c2ab","attributes":{"message":"Updating data..."},"expressions":{}},{"name":"btnChangePassword","type":"button","item-type":"button","_auto_id_":"c02075c5-451f-401c-bafc-4619faa85c0b","content":"Change Password","theme":"default","left-icon":"fa-rotate-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var pageData = cti.store.pages.ChangeMyPassword;\n\nif (!pageData || !pageData.txtCurrentPassword) {\n  return application.warningMessage('Please enter your current password', 'Cannot change password');\n}\n\nvar passwordOk = cti.fnIsPasswordAcceptable(pageData.txtNewPassword);\nif (!passwordOk.result) {\n  return application.warningMessage(passwordOk.err, 'Cannot change password');\n}\n// TODO Check new password === confirm password\nif (pageData.txtNewPassword !== pageData.txtConfirmPassword) {\n  return application.warningMessage('Please correctly confirm your new password', 'Cannot change password');\n}\n\nlet payload = { \"newPassword\": pageData.txtNewPassword, \"oldPassword\": pageData.txtCurrentPassword }\napplication.startLoader('Please wait a moment...');\napplication.api(\"account/changepassword\", { \n  method: \"POST\", \n  payload: payload, \n  responseActionFlow: \"OnChangePWResponse\", \n  ttlSeconds: -1 \n});\n"},"_auto_id_":"96e73bdb-f906-4960-83df-45d23beb7516"}],"classes":"action-btn"}],"_auto_id_":"e2b11fe5-f8f8-44b5-9eba-9666695b028e","expressions":{},"classes":"menuScroll"}]},{"start":false,"name":"Shift","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"7a7ee536-1246-4883-a73f-a381c6965e6f","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"/*\nInitialise or update our shift management data objects\n*/\ncti.store.variables.page = \"Shift\";\n\nconsole.log(\"Shift page loaded\");\nif (!cti.store.shift) {\n  cti.store.shift = {}\n  Object.assign(cti.store.shift, cti.store.api.shift.data[0][0]);\n}\nif (!cti.store.shift.employees) {\n  cti.store.shift.employees = []\n  Object.assign(cti.store.shift.employees, cti.store.api.shift.data[1]);\n}\nif (!cti.store.shift.plant) {\n  cti.store.shift.plant = []\n  Object.assign(cti.store.shift.plant, cti.store.api.shift.data[2]);\n}\nif (!cti.store.shift.work) {\n  cti.store.shift.work = []\n  Object.assign(cti.store.shift.work, cti.store.api.shift.data[3]);\n}\n"},"_auto_id_":"14ba7c23-e59e-4606-8cc9-d3a057e435ff","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnGoBack","type":"button","item-type":"button","_auto_id_":"a4c87506-58d3-4db0-9dbf-f06a8ba4283a","content":"","theme":"default","left-icon":"fa-chevron-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fnSaveAvailability();\napplication.back();"},"_auto_id_":"cd0f99ea-18ee-4144-9047-8cbf5a296aa8"}],"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h1>{{'$store.user.gangDescription' | store}} - Shift</h1>","_auto_id_":"e3f75895-3b96-49ed-933d-42ec40a2251a"}],"_auto_id_":"26d87844-1784-4bec-8123-6c66dfcb04af"},{"name":"static_1","type":"area","item-type":"static","_auto_id_":"58a93949-daa8-41c5-a385-8ba56b26b325","content":[{"name":"btnBeginShift","type":"button","item-type":"button","_auto_id_":"05f53bab-938a-4eb7-a647-ba37d91756fd","content":"Begin Shift","theme":"default","left-icon":"fa-play","expressions":{"show":"!$store.shift.Active"},"classes":"action-btn-default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppStartShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n"},"_auto_id_":"0c0494eb-f4c7-4d85-8de9-002d8565ddec"}]},{"name":"btnWorksOrders","type":"button","item-type":"button","_auto_id_":"1ac2fde5-9e9f-4462-8fed-03f06e3afae9","content":"Works Orders","theme":"default","left-icon":"fa-road","expressions":{"show":"$store.shift.Active"},"classes":"action-btn-default","actions":[{"event":"click","type":"go-to-page","data":{"name":"WorksOrders","isConditional":false},"_auto_id_":"74c72953-177f-47a8-ae38-0384e3f2f3ab"}]},{"name":"btnEndShift","type":"button","item-type":"button","_auto_id_":"ba1c3f10-d5d6-45df-a3b3-c583da6b9905","content":"End Shift","theme":"default","left-icon":"fa-stop","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fnRequestEndShift();"},"_auto_id_":"bc6bc4a1-bf4b-4a1d-9d4e-39026e22ae06"}],"expressions":{"show":"$store.shift.Active"},"classes":"action-btn-default"}],"expressions":{},"classes":"static-header-toolbar"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"ppStartShift","type":"component","item-type":"web-component","content":[{"name":"html_7","type":"content","item-type":"html","_auto_id_":"31e0c5c4-36af-4ca2-80fe-f4d1615e3e14","content":"<h2>Start shift</h2>\n<div>Are you sure you want to start the shift now?</div>"},{"name":"button_bar_2","type":"area","item-type":"button-bar","_auto_id_":"ac7e67ff-54a4-47bb-9400-6c3c91a715d4","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_1","type":"button","item-type":"button","_auto_id_":"23cebc24-e455-4ca9-8ff8-8fb5089a42c4","content":"Yes","theme":"default","left-icon":"fa-check","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppStartShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\ncti.fnAPI_ShiftStart();\ncti.store.shift.Active = true;"},"_auto_id_":"752cf4bb-62cd-47b8-bb9a-f0deeadf90b8"}],"expressions":{},"classes":"popup-btn"},{"name":"button_2","type":"button","item-type":"button","_auto_id_":"866e8ebf-9f2f-40ad-aafd-38acd7bca2c5","content":"No","theme":"default","left-icon":"fa-close","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppStartShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n"},"_auto_id_":"653e54d6-5864-4bc8-8656-1700c8657ff0"}],"expressions":{},"classes":"popup-btn"}],"expressions":{}}],"componentId":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","_auto_id_":"f3541eba-9974-4be6-b8d1-581cfba1a96f","attributes":{"id":"ppStartShift"},"expressions":{}},{"name":"ppEndShift","type":"component","item-type":"web-component","content":[{"name":"html_8","type":"content","item-type":"html","_auto_id_":"795030b0-1cde-4cf8-9089-be08df90ac77","content":"<h2>End shift</h2>\n<div>{{'$store.variables.endShiftMessage' | store}}</div>"},{"name":"button_bar_3","type":"area","item-type":"button-bar","_auto_id_":"d4037732-7cf9-44fc-a6d9-aa71920d11c1","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_3","type":"button","item-type":"button","_auto_id_":"43ae81e4-7c94-4c2e-9318-3aee34fcf742","content":"Yes","theme":"default","left-icon":"fa-check","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppEndShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\ncti.fnAPI_ShiftEnd();\ncti.store.shift.Active = false;"},"_auto_id_":"7958aa58-3bc7-4ec3-9125-b87f1a8fe12f"}],"expressions":{},"classes":"popup-btn"},{"name":"button_4","type":"button","item-type":"button","_auto_id_":"93f71c89-fe5a-47b2-9bee-19e17f2f2400","content":"No","theme":"default","left-icon":"fa-close","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppEndShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n"},"_auto_id_":"4f41c44e-9b99-40e2-a93a-494d28ca9b6c"}],"expressions":{},"classes":"popup-btn"}]}],"componentId":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","_auto_id_":"2aec38d9-75b7-48ae-9a75-bc49472120fc","attributes":{"id":"ppEndShift"},"expressions":{},"actions":[]},{"name":"menu","type":"component","item-type":"web-component","content":[{"name":"btnSupport","type":"button","item-type":"nav-button","_auto_id_":"b5c0bfcd-d5c5-47bc-bcff-d6892bc9ed02","extends":{"type":"button","item-type":"button"},"content":"Support","actions":[{"event":"click","type":"go-to-page","data":{"name":"Support","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-question"}],"componentId":"e677c899-4008-4d70-8601-452873cad5bc","_auto_id_":"3404b0a3-4e6a-4ccf-b176-aa824d48287c","attributes":{},"expressions":{}},{"name":"loader","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"e37aa320-e153-40ce-a0e6-2a0cae485be5","attributes":{"message":"Updating, please wait a moment..."},"expressions":{}},{"name":"html_5","type":"content","item-type":"html","_auto_id_":"359cc1c3-1c8c-4559-bf16-377b91962e46","content":"<span class=\"deemphasis-x\">The employees and plant below are allocated to this gang at present. Please tap on each one to indicate if they are available for the shift before beginning the shift.</span>\n<br/><br/>\nTeam members allocated"},{"name":"list_1","type":"content","item-type":"list","_auto_id_":"1aa19540-afbd-4c9b-a674-cc1b9fe3051c","static":false,"model":"$store.shift.employees","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"html_1","type":"content","item-type":"html","_auto_id_":"104c719c-12eb-465a-b1a4-c434e45f732d","content":"<div class=\"list-card\">\n  <div class=\"column-icon shift-{{$data.$item.Available}}\">\n    <i class=\"fa fa-2x\"></i>\n  </div>\n  <div class=\"column column-60pc\">\n    <span class=\"emphasis\">{{$data.$item.Name}}</span> <span>({{$data.$item.EmpCode}})</span><br/>\n    <span>Shift hours: {{$data.$item.ShiftHours}}</span>\n  </div>\n  <div class=\"column column-20pc deemphasis\">\n    Available for shift?<br/>\n    <span class=\"shift-availability\">{{$data.$item.Available}} </span> \n  </div>\n</div>","expressions":{}}],"dataSource":"dynamic","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if ($data.$item.Available == \"unknown\") {\n  $data.$item.Available = \"available\";\n}\nelse if ($data.$item.Available == \"available\") {\n  $data.$item.Available = \"unavailable\";\n}\nelse {\n  $data.$item.Available = \"available\";\n}\n\nlet cat = \"employee\";\ncti.store.variables.availabilityUpdates = cti.store.variables.availabilityUpdates || [];\nlet e = cti.store.variables.availabilityUpdates.find(u => u.type==cat&&u.id==$data.$item.Id);\nif (e) { e.available = $data.$item.Available; }\nelse {\n  cti.store.variables.availabilityUpdates.push({\n    id: $data.$item.Id,\n    available: $data.$item.Available,\n    type: cat,\n    switchTime: application.dbDatetime(new Date())\n  });\n}\n\n\n"},"_auto_id_":"c5507dc3-66e7-4fe3-8a70-0c76e12785bd","actions":[]}],"paginationItemsPerPage":12,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPagesToDisplay":5,"expressions":{}},{"name":"html_6","type":"content","item-type":"html","_auto_id_":"dd589530-6fb3-4427-816d-bab09ec13afe","content":"Plant items allocated"},{"name":"list_2","type":"content","item-type":"list","_auto_id_":"1bf3576e-311b-4c10-8136-40d236e59763","static":false,"model":"$store.shift.plant","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"html_2","type":"content","item-type":"html","_auto_id_":"313f6727-0604-44ff-860f-cf31f2fbc740","content":"<div class=\"list-card\">\n  <div class=\"column-icon shift-{{$data.$item.Available}}\">\n    <i class=\"fa fa-2x\"></i>\n  </div>\n  <div class=\"column column-60pc\">\n    <span class=\"emphasis\">{{$data.$item.Description}}</span> <br/>\n    <span>{{$data.$item.FleetNumber}}</span>\n  </div>\n  <div class=\"column column-20pc deemphasis\">\n    Available for shift?<br/>\n    <span class=\"shift-availability\">{{$data.$item.Available}} </span>\n  </div>\n</div>"}],"dataSource":"dynamic","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if ($data.$item.Available == \"unknown\") {\n  $data.$item.Available = \"available\";\n}\nelse if ($data.$item.Available == \"available\") {\n  $data.$item.Available = \"unavailable\";\n}\nelse {\n  $data.$item.Available = \"unknown\";\n}\n\nlet cat = \"plant\";\ncti.store.variables.availabilityUpdates = cti.store.variables.availabilityUpdates || [];\nlet e = cti.store.variables.availabilityUpdates.find(u => u.type==cat&&u.id==$data.$item.Id);\nif (e) { e.available = $data.$item.Available; }\nelse {\n  cti.store.variables.availabilityUpdates.push({\n    id: $data.$item.Id,\n    available: $data.$item.Available,\n    type: cat\n  });\n}\n\n"},"_auto_id_":"2636023f-87f4-4a46-bc5f-72d36df28103"}],"paginationItemsPerPage":12,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPagesToDisplay":5,"expressions":{}}],"_auto_id_":"7988500e-ffcc-4353-8a20-054c37e22c03","expressions":{},"classes":"list-host no-top-padding"}]},{"start":false,"name":"WorksOrders","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"ce9933d4-6533-4d7f-8ebd-5ffa3200d80b","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"cti.store.variables.page = \"WorksOrders\";\n\nconsole.log(\"WorksOrders page loaded\");"},"_auto_id_":"86630122-582a-4d09-9e63-95637a0adeec","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnGoBack","type":"button","item-type":"button","_auto_id_":"9bc52685-cbd5-49c8-a8aa-f8bd470d1816","content":"","theme":"default","left-icon":"fa-chevron-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"application.back();"},"_auto_id_":"bd050a42-8888-48a0-9157-72c42efe2833"}],"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h1>{{'$store.user.gangDescription' | store}} - Works Orders</h1>","_auto_id_":"e1c2df2b-e81f-472b-a4c1-1a7be64fc302"}],"_auto_id_":"932c3195-c5fb-4366-9566-a18b22754e8f"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"loader","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"5cfa1f07-16e4-4fd5-8672-95ef03847e30","attributes":{"message":"Updating, please wait a moment..."},"expressions":{}},{"name":"list_1","type":"content","item-type":"list","_auto_id_":"7b789383-600e-41e0-a949-49c21e7ecc72","static":false,"model":"$store.shift.work","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"html_1","type":"content","item-type":"html","_auto_id_":"26a28305-ea8c-49f1-b7fb-c1f9eec78be4","content":"<div class=\"list-card large\">\n  <div class=\"column-icon work-indicator-{{$data.$item.Status}}\">\n    <span class=\"card-dd\">{{$data.$item.dd}}</span>\n    <span class=\"card-mon\">{{$data.$item.mon}}</span>\n  </div>\n  <div class=\"column\">\n    <div class=\"card-row upper\">\n    \t<span class=\"emphasis\">{{$data.$item.SummaryHeader}} </span>\n      <span>{{$data.$item.Status}}</span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Summary</span>\n      <span class=\"upper\">{{$data.$item.DefectDescription}}</span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Location</span>\n      <span class=\"upper\">{{$data.$item.SummaryLocation}}</span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Plan Duration</span>\n      <span class=\"upper\">{{$data.$item.PlanDuration}}</span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Priority</span>\n      <span class=\"upper\">{{$data.$item.PriorityDescription}}</span>\n    </div>\n  </div>\n</div>","expressions":{}}],"dataSource":"dynamic","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if ($data.$item.status==\"rejected\" || $data.$item.status==\"completed\" || $data.$item.status==\"recalled\") {\n  application.infoMessage(\"Sorry, this Works Order is no longer available.\");\n  return false;\n}\ncti.fnSetCurrentJob($data.$item);"},"_auto_id_":"f4dd1c33-f0ec-4596-afa5-9a7d9d35e5e3"}],"paginationItemsPerPage":12,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPagesToDisplay":5,"expressions":{}}],"_auto_id_":"3eddc449-37ec-47d6-9925-bc13ebe4ef4e","expressions":{},"classes":"list-host"}]},{"start":false,"name":"WorkItem","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"d1809838-2c21-43dd-beb6-2b3f764283b1","actions":[{"event":"onload","type":"inline-function","data":{"sync":false,"code":"/*\nAdd any pre-formed html content\n*/\n\ncti.store.variables.page = \"WorkItem\";\n\n\nlet mapPlotter = {\n  _elem: undefined,\n  _job: undefined,\n  start: function() {\n\tthis._elem = document.getElementById('mapPanel');\n    this._job = cti.store.current;\n    if (!this._job) {\n      return this.fail(\"Unable to plot map; relevant job data not available\", \"Unable to plot map, job store object is not defined\");\n    }\n    this.getJobLatLon();\n  },\n  getJobLatLon: function() {\n    if (this._job.lat && this._job.lon) {\n      this.status(\"Retrieved cached location for job...\");\n      return this.plotLanLon(this._job.lat, this._job.lon);\n    }\n    else if (this._job.Latitude && this._job.Longitude) {\n      this.status(\"Retrieved location for job...\");\n      return this.plotLanLon(this._job.Latitude, this._job.Longitude);\n    }\n    else if (this._job.NavigationLocation) {\n\t    application.logEvent(\"Calling \" + this._job.NavigationLocation);\n\t\twindow.fetch(this._job.NavigationLocation)\n\t\t.then(r => r.json())\n\t\t.then(j => this.lookupLocation(j))\n\t\t.catch(e => this.fail(\"Unable to plot map location location (err 1)\", \"GeoLocation lookup failed: \" + JSON.stringify(e)));\n    }\n    else if (!this._job.Easting || !this._job.Northing) {\n      return this.fail(\"No map available, Head Office did not specify job location co-ordinates\", \"Unable to plot map, no co-ordinates supplied from Head Office\");\n    }\n    else {\n      return this.fail(\"No map available, Head Office did not specify job location co-ordinates\", \"Unable to plot map, no lookup link was made available\");\n    }\n  },\n  lookupLocation: function(location) {\n    application.logEvent(\"Location lookup response = \" + JSON.stringify(location));\n    if (!location.LATITUDE || !location.LONGITUDE) {\n      return this.fail(\"Unable to plot map location location (err 2)\", \"GeoLocation lookup returned no valid co-ordinates\");\n    }\n    \n    this._job.lat = location.LATITUDE;\n    this._job.lon = location.LONGITUDE;\n    //this._job.lat = lat;\n    //this._job.lon = lon;\n    return this.plotLanLon(location.LATITUDE, location.LONGITUDE, key);\n  },\n  plotLanLon: function(lat, lon) {\n    var key = (cti.store.schema.settings.mapping) ? cti.store.schema.settings.mapping.googleMapsAPIKey : undefined;\n    var mode = (cti.store.schema.metadata && cti.store.schema.metadata.mapmode) ? (cti.store.schema.metadata.mapmode || 0) : 0;\n    \n    application.logEvent(\"Set WO location = \" + lat + \", \" + lon);\n    // If we haven't explicitly asked for Google Maps, or no key has been set, use OpenStreetMaps\n    if (mode != 1 || !key) {\n\t    return this.plotUsingOpenStreetmaps(lat, lon);\n    }\n    else {\n      return this.plotUsingGoogleMaps(lat, lon, key);\n    }\n  },\n  plotUsingGoogleMaps: function(lat, lon, key) {\n    // Ensure job has co-ordinates so we don't waste time looking up again later...\n    application.logEvent(\"Using GoogleMaps API Key = \" + key);\n    \n    var url = 'https://maps.googleapis.com/maps/api/js?key=' +key + '&callback=cti.fnWorkMapReady'\n    \n    // Will handoff to cti.fnWorkMapReady when rendered, and that will plot the location marker\n    //if ($(\"head script[src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAJ5CO4zuiE1AL_M-uUoioigScCRiUjKoQ&callback=cti.fnWorkMapReady']\").length == 0) {\n    var urlref = \"head script[src='\"+url+\"']\"; \n    if ($(urlref).length == 0) {\n      var s = document.createElement(\"script\");\n      s.type = \"text/javascript\";\n      s.src = url;\n      //s.src = \"https://maps.googleapis.com/maps/api/js?key=AIzaSyAJ5CO4zuiE1AL_M-uUoioigScCRiUjKoQ&callback=cti.fnWorkMapReady\";\n      s.async = true;\n      s.defer = true;\n      $(\"head\").append(s);\n      application.logEvent(\"Map instance requested from Google Maps API\");\n      return true;\n   }\n   else {\n     cti.fnWorkMapReady();\n     return true;\n   }\n  },\n  plotUsingOpenStreetmaps: function(lat, lon) {\n    /*\n    var styles = document.createElement('link');\n  styles.rel = 'stylesheet';\n  styles.type = 'text/css';\n  styles.media = 'screen';\n  styles.href = 'path/to/css/file';\n  document.getElementsByTagName('head')[0].appendChild(styles);\n    */\n    var url = 'https://unpkg.com/leaflet@1.3.1/dist/leaflet.js';\n    var css = 'https://unpkg.com/leaflet@1.3.1/dist/leaflet.css';\n    /*\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.3.1/dist/leaflet.css\" integrity=\"sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==\" crossorigin=\"\"/>\n  <script src=\"https://unpkg.com/leaflet@1.3.1/dist/leaflet.js\" integrity=\"sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==\" crossorigin=\"\"></script>\n    */\n    var urlref = \"head script[src='\"+url+\"']\"; \n    if ($(urlref).length == 0) {\n      var style = document.createElement(\"link\");\n      style.rel = \"stylesheet\";\n      style.type = \"text/css\";\n      style.media = \"screen\";\n      style.integrity = \"sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==\";\n      style.href = css;\n      style.async = true;\n      style.defer = true;\n      style.crossorigin = \"\";\n      $(\"head\").append(style);\n      \n      var s = document.createElement(\"script\");\n      s.type = \"text/javascript\";\n      s.integrity = \"sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==\";\n      s.src = url;\n      s.async = true;\n      s.defer = true;\n      s.crossorigin = \"\";\n      $(\"head\").append(s);\n      application.logEvent(\"Map instance requested from OpenStreetMaps\");\n      application.logEvent(\"Need to invoke plotting function via setTimeout\");\n      setTimeout(function() { cti.fnOpenStreetMapReady(); }, 1000);\n      return true;\n   }\n   else {\n     cti.fnOpenStreetMapReady();\n     return true;\n   }\n  },\n  status: function(msg, logMsg) {\n    if (this._elem) this._elem.innerHTML = msg;\n    if (logMsg) application.logEvent(logMsg);\n    return true;\n  },\n  fail: function(msg, verboseMsg) {\n    this.status(msg, verboseMsg);\n    return (!this.done());\n  },\n  done: function() {\n    // end of map processing\n    return true;\n  }\n}\n\nfunction translateLocation(url, cb, fail) {\n\twindow.fetch(url)\n\t\t.then(r => r.json())\n\t\t.then(j => cb(j))\n\t\t.catch(e => fail(JSON.stringify(e)));\n}\n\nsetTimeout(() => {\n\tif (window.debug) {\n\t\tdebugger;\n\t}  \n  /*\n  let sorData = cti.store.current.sorData ? atob(cti.store.current.sorData) : '';\n  let sorDataElement = document.getElementById('sorData');\n  if (sorDataElement) {\n    sorDataElement.innerHTML = sorData;\n  }\n\nlet extraData = cti.store.current.extraData ? atob(cti.store.current.extraData) : undefined;\n  let extraDataElement = document.getElementById('extraData');\n  if (extraDataElement && extraData) {\n    extraDataElement.innerHTML = extraData;\n  }\n  */\n  \n  mapPlotter.start();\n}, 500);\n\n"},"_auto_id_":"92a4f3f8-41ed-4a53-9f8a-ff6b3c012232","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"title","type":"content","item-type":"title","content":"<h1>{{'$store.user.gangDescription' | store}} - Work Item</h1>","_auto_id_":"8d247340-61a4-4ad6-bfb0-3f5e93bf27a4"}],"_auto_id_":"7f59a91c-917e-4f30-9694-9293e7dd605d"},{"name":"static_4","type":"area","item-type":"static","_auto_id_":"2ee7cb03-c0b6-42a7-94cf-a125665856b7","content":[{"name":"htSummary","type":"content","item-type":"html","_auto_id_":"135be1ef-0ae7-4f70-be2e-0d74255d6721","content":"<div class=\"list-card header-card\">\n  <div class=\"column-icon work-indicator-{{'$store.current.Status' | store}}\">\n  </div>\n  <div class=\"column\">\n    <div class=\"card-row upper\">\n\t\t<span class=\"emphasis\">{{'$store.current.SummaryHeader' | store}} </span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Status</span>\n      <span class=\"upper\">{{'$store.current.Status' | store}}</span>\n    </div>\n    <div class=\"card-row\">\n      <span class=\"emphasis\">Summary</span>\n      <span class=\"upper\">{{'$store.current.SummaryDescription' | store}}</span>\n    </div>\n  </div>\n</div>","expressions":{}}],"expressions":{},"classes":"static-header work-item"},{"name":"static_1","type":"area","item-type":"static","_auto_id_":"fac494bf-46db-45a9-a10a-2a79ef039fa5","content":[{"name":"btnReturn","type":"button","item-type":"button","_auto_id_":"60221bc4-effd-46d4-ad05-fb53b397976c","content":"Back to list","theme":"default","left-icon":"fa-mail-reply","expressions":{"show":"$store.current.Status==\"new\"||$store.current.Status==\"suspended\"||$store.current.Status==\"complete\"||$store.current.Status==\"rejected\""},"classes":"action-btn-default","actions":[{"event":"click","type":"go-back","data":{},"_auto_id_":"64a2a535-dca5-414d-bfa5-787d8358a99e"}]},{"name":"btnAccept","type":"button","item-type":"button","_auto_id_":"691e2b1f-e6fe-4dfe-84aa-4bae9a2c34ae","content":"Accept","theme":"default","left-icon":"fa-thumbs-o-up","expressions":{"show":"$store.current.Status==\"new\""},"classes":"action-btn-default positive","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fnSaveCurrentItemStatus(\"accepted\");\n"},"_auto_id_":"c77643cd-2c09-44b6-8e15-cf4a5e59f8a4"}]},{"name":"btnComplete","type":"button","item-type":"button","_auto_id_":"2ffc7b96-b8a5-40ed-94a0-b83455eaa791","content":"Work Completed","theme":"default","left-icon":"fa-thumbs-o-up","expressions":{"show":"$store.current.Status==\"accepted\""},"classes":"action-btn-default positive","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppConfirmClose\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\n"},"_auto_id_":"bf08aea8-3270-4757-a058-92781bba0111"}]},{"name":"btnSuspend","type":"button","item-type":"button","_auto_id_":"73082bed-b22e-4129-95f5-d52b6906211d","content":"Suspend Work","theme":"default","left-icon":"fa-pause","expressions":{"show":"$store.current.Status==\"accepted\""},"classes":"action-btn-default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.WorkItem && cti.store.pages.WorkItem.txtSuspendReason) {\n  delete cti.store.pages.WorkItem.txtSuspendReason;\n}\n\nvar popup = document.getElementById(\"ppSuspendWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();"},"_auto_id_":"df46290d-de04-443d-b271-abcb5b16a2c0"}]},{"name":"btnResume","type":"button","item-type":"button","_auto_id_":"fa867a1a-47b1-42ae-a36e-3d2d50534a17","content":"Resume","theme":"default","left-icon":"fa-play","expressions":{"show":"$store.current.Status==\"suspended\""},"classes":"action-btn-default positive","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fnSaveCurrentItemStatus(\"accepted\");\n"},"_auto_id_":"78ec9217-2b6f-4fe7-b4d4-fd46590efdce"}]},{"name":"btnReject","type":"button","item-type":"button","_auto_id_":"c1c803ca-51c4-4ed2-8272-63e59bc2a31d","content":"Reject","theme":"default","left-icon":"fa-thumbs-o-down","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.WorkItem && cti.store.pages.WorkItem.txtRejectReason) {\n  delete cti.store.pages.WorkItem.txtRejectReason;\n}\n\nvar popup = document.getElementById(\"ppRejectWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\n"},"_auto_id_":"5694e632-07e6-4f13-94fd-1442b9c50e42"}],"expressions":{"show":"($store.current.Status==\"new\"||$store.current.Status==\"accepted\")&&$store.current.PriorityDescription!=\"EMERGENCY\""},"classes":"action-btn-default negative"}],"expressions":{},"classes":"static-header-buttonbar"},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"ppConfirmClose","type":"component","item-type":"web-component","content":[{"name":"html_13","type":"content","item-type":"html","_auto_id_":"07e79b40-59f6-4ee7-81ab-333076c7cc9e","content":"<h2>Complete Works Order</h2>\n<div>Are you sure you want to complete this works order?</div>"},{"name":"button_bar_5","type":"area","item-type":"button-bar","_auto_id_":"34206515-dbf0-4fc9-be2f-0d2131525875","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_14","type":"button","item-type":"button","_auto_id_":"a5aa4e5a-7b05-4ab6-aa04-1c8c1417b677","content":"Yes, complete","theme":"default","left-icon":"fa-check","expressions":{},"classes":"popup-btn","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppConfirmClose\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\ncti.fnSaveCurrentItemStatus(\"complete\");\nif (cti.store.current.IsEmergencyJob) {\n  cti.store.current.Status = \"new\";\n\tapplication.infoMessage(\"Emergency job completed, any further emergency work may be done against the same job.\");\n}\nelse {\n\tapplication.infoMessage(\"Works Order completed.\");\n}\napplication.back();\n"},"_auto_id_":"5a4f96ac-2fce-45d3-bc73-5d9746ef7b18"}]},{"name":"button_15","type":"button","item-type":"button","_auto_id_":"3724b700-e387-4ae4-93cd-f8394dfd91ed","content":"No, carry on","theme":"default","left-icon":"fa-close","expressions":{},"classes":"popup-btn","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppConfirmClose\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();"},"_auto_id_":"6bd36766-afbc-47b0-8aee-df97f570a4b1"}]}]}],"componentId":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","_auto_id_":"447aea99-63e7-423d-8ec4-b9f5d0060473","attributes":{"id":"ppConfirmClose"},"expressions":{}},{"name":"ppRejectWO","type":"component","item-type":"web-component","content":[{"name":"html_7","type":"content","item-type":"html","_auto_id_":"786ae676-a21b-41e5-a4b8-4a1aa41c137a","content":"<h2>Reject Works Order</h2>\n<div>Are you sure you want to reject this item? If so, please give the reason in the box below and tap \"Yes\".</div>","expressions":{}},{"name":"txtRejectReason","type":"user-input","item-type":"text","_auto_id_":"0ae897ec-0ffd-495f-b83f-f04edf67e121","label":"Reason","required":false,"multiline":false,"debounce":250,"expressions":{},"placeholder":"why are you cancelling this item?","maxlength":100,"actions":[],"validators":[]},{"name":"button_bar_1","type":"area","item-type":"button-bar","_auto_id_":"9f8e5e57-0263-41e0-8eed-872b3935c0b9","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_1","type":"button","item-type":"button","_auto_id_":"a687185a-edbd-479c-a983-97050cfc3be5","content":"Yes, reject","theme":"default","left-icon":"fa-check","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (!cti.store.pages.WorkItem || !cti.store.pages.WorkItem.txtRejectReason) {\n  application.warningMessage(\"Please give your reason for rejecting\", \"Reject Works Order\");\n  return false;\n}\n\nvar popup = document.getElementById(\"ppRejectWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\ncti.fnSaveCurrentItemStatus(\"rejected\", cti.store.pages.WorkItem.txtRejectReason);\napplication.back();"},"_auto_id_":"5bf656ab-aab0-4760-9796-6fed4e151c22"}],"expressions":{},"classes":"popup-btn"},{"name":"button_2","type":"button","item-type":"button","_auto_id_":"1462a9f8-3a74-4f53-bfa8-d3470b52f7e0","content":"No, do not reject","theme":"default","left-icon":"fa-close","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppRejectWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n"},"_auto_id_":"45a88265-9562-4ff1-9279-c684eab82244"}],"expressions":{},"classes":"popup-btn"}],"expressions":{}}],"componentId":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","_auto_id_":"84822003-c275-4fd1-9e87-467664e12849","attributes":{"id":"ppRejectWO"},"expressions":{},"actions":[]},{"name":"ppSuspendWO","type":"component","item-type":"web-component","content":[{"name":"html_12","type":"content","item-type":"html","_auto_id_":"566e2f0c-5556-4896-b76f-50852098ca05","content":"<h2>Suspend Works Order</h2>\n<div>Are you sure you want to suspend this item? If so, please give the reason in the box below and tap \"Yes\". The order can be resumed later.</div>"},{"name":"txtSuspendReason","type":"user-input","item-type":"text","_auto_id_":"0494ec52-60e3-46be-a1c1-09b474fe82bb","label":"Reason","required":false,"multiline":false,"debounce":250,"placeholder":"why are you suspending this item?","expressions":{}},{"name":"button_bar_4","type":"area","item-type":"button-bar","_auto_id_":"cb5f58d5-b2cf-4d7d-b4fe-43211698df21","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_11","type":"button","item-type":"button","_auto_id_":"a4497472-d7c0-455b-8f8f-b882b2ef6325","content":"Yes, suspend","theme":"default","left-icon":"fa-check","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (!cti.store.pages.WorkItem || !cti.store.pages.WorkItem.txtSuspendReason) {\n  application.warningMessage(\"Please give your reason for suspending\", \"Suspend Works Order\");\n  return false;\n}\n\nvar popup = document.getElementById(\"ppSuspendWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\ncti.fnSaveCurrentItemStatus(\"suspended\", cti.store.pages.WorkItem.txtSuspendReason);\napplication.infoMessage(\"Works Order suspended, you can resume it when needed from the Works Order list.\");\napplication.back();\n"},"_auto_id_":"76fc5ceb-9831-4926-8668-d0218d5d1492"}],"expressions":{},"classes":"popup-btn"},{"name":"button_12","type":"button","item-type":"button","_auto_id_":"e266f4ca-dc4b-409f-814e-c78dd8fc2b9e","content":"No, do not suspend","theme":"default","left-icon":"fa-close","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var popup = document.getElementById(\"ppSuspendWO\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n"},"_auto_id_":"cf69996e-8244-4324-b906-86a91404eecb"}],"expressions":{},"classes":"popup-btn"}],"expressions":{}}],"componentId":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","_auto_id_":"4388256e-d5cd-4e63-900d-a4a3804a5f0c","attributes":{"id":"ppSuspendWO"},"expressions":{},"actions":[]},{"name":"Loader_2","type":"component","item-type":"web-component","content":[],"componentId":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","_auto_id_":"3a1a9bcf-9469-480b-aacc-a229d67f899f","attributes":{"message":"Getting current location..."}},{"name":"menu","type":"component","item-type":"web-component","content":[{"name":"btnSupport","type":"button","item-type":"nav-button","_auto_id_":"cbc4454b-4a62-4c8c-b3f4-a767a079e5b5","extends":{"type":"button","item-type":"button"},"content":"Support","actions":[{"event":"click","type":"go-to-page","data":{"name":"Support","isConditional":false}}],"expressions":{},"theme":"default","left-icon":"fa-question"},{"name":"btnNavigate","type":"button","item-type":"button","_auto_id_":"0d94684a-8650-4840-94ae-d83262db4289","content":"Navigate to location","theme":"default","left-icon":"fa-map-pin","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n\tdebugger;\n}\nif (!cti.store.current.lat || !cti.store.current.lat) {\n  \tapplication.warningMessage(\"No GPS location information was supplied by head office for this job.\", \"Navigation\");\n\treturn false;\n}\n\nlet dest = cti.store.current.lat + \",\" + cti.store.current.lon;\n\ncti.utils.callAction(\"call-url\", {\"name\":\"GoogleMapping\",\"params\":{ \"saddr\": \"\", \"daddr\":dest}});  \n\nreturn false;\n\napplication.startLoader('Getting location...');\napplication.updateLocation(function(err, loc) {\n  application.stopLoader();\n\n  if (err) {\n  \tapplication.warningMessage(err.message || \"Unable to retrieve your current location, navigation cannot be started.\", \"Navigation\");\n  }\n  else {\n    var src = loc.latitude + \",\" + loc.latitude;\n\tcti.utils.callAction(\"call-url\", {\"name\":\"GoogleMapping\",\"params\":{\"saddr\":src, \"daddr\":dest}});  \n  }\n});\n\n"},"_auto_id_":"0e2491d2-b268-4195-90b0-a2d2b12ab4b8"}],"expressions":{}}],"componentId":"e677c899-4008-4d70-8601-452873cad5bc","_auto_id_":"25d67f57-7e98-4902-9a81-3d1fda2fea54","attributes":{},"expressions":{}},{"name":"html_11","type":"content","item-type":"html","_auto_id_":"629d4d40-a2c7-42d4-8667-c0c28bffd014","content":"<div class=\"header-section\">Works Order Detail</div>\n<hr/>\n<div class=\"detail-section\">\n\t<span class=\"emphasis\">Priority</span>\n    <span class=\"upper\">{{'$store.current.PriorityDescription' | store}}</span>\n    <br/>\n\t<span class=\"emphasis\">Works Order</span>\n\t<span class=\"upper\">{{'$store.current.WorksOrderNumber' | store}}</span>\n    <br/>\n\t<span class=\"emphasis\">Defect</span>\n\t<span class=\"upper\">{{'$store.current.Defect' | store}}</span>\n    <br/>\n\t<span class=\"emphasis\">Description</span>\n\t<span class=\"upper\">{{'$store.current.DefectDescription' | store}}</span>\n    <br/>\n\t<span class=\"emphasis\">Traffic Management</span>\n\t<span class=\"upper\">{{'$store.current.TrafMan' | store}}</span>\n\t<br/>\n    <div id=\"extraData\">\n  </div>\n</div>\n<br/>\n\n<div class=\"header-section\">Location</div>\n<hr/>\n<div class=\"detail-section\">\n    <span class=\"emphasis upper\">{{'$store.current.SummaryLocation' | store}}</span>\n</div>\n<div id=\"mapPanel\" class=\"detail-section\">\n  Checking for map location...\n</div>\n<br/>\n\n<div class=\"header-section\">SOR Items</div>\n<hr/>\n<div id=\"sorData\" ng-bind-html=\"'$store.current.displaySorData' | store\" class=\"detail-section sordata\">\n  {{'$store.current.displaySorData' | store}}\n</div>\n<br/>","expressions":{}}],"_auto_id_":"b7375ecb-34d8-40d8-a581-739531e52ba1","expressions":{},"classes":"list-host no-padding"}]}],"actionflows":[{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"application.stopLoader();\n\n// Was the login request successful?\nif ($data.success) {\n  cti.store.variables.lastlogin = cti.store.variables.lastloginHash;\n  cti.store.variables.lastloginHash = undefined;\n  cti.store.variables.workOffline = false;\n  // This is essential - stores our auth token etc where the app framework can find it\n  var profile = application.setUserProfile($data.response);\n  var userKey = profile.username.toLowerCase() + \"|\" + profile.gangId;\n  // If the username of gang id are different, we can't use any cached data\n  var newUser = (!cti.store.variables.lastUserKey || (cti.store.variables.lastUserKey != userKey));\n  // Take a backup of the user profile so we can allow offline running for the user later\n  cti.store.variables.lastUserProfile = {};\n  Object.assign(cti.store.variables.lastUserProfile, profile);\n  cti.fnHousekeepingCheck(newUser);\n  cti.store.variables.lastloginTime = new Date();\n  cti.store.variables.lastUserKey = userKey;\n  application.api(\"getactiveshift/\" + profile.gangId, { \n    method: \"GET\", \n    responseActionFlow: \"OnActiveShift\", \n    ttlSeconds: 0, \n    apiStoreKey: \"shift\" \n  });\n  \n  let message = $data.response && $data.response.data && $data.response.data.message;\n  if (message) {\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"InfoMessage\", \"title\": \"Information\", \"text\": message });\n  }\n  application.goto(\"Menu\");\n  \n}\nelse {\n  if ($data.error.httpStatus == 0) {\n    if (cti.store.variables.lastlogin && cti.store.variables.lastlogin == cti.store.variables.lastloginHash && cti.store.variables.lastUserProfile) {\n      // We have matched our previously successful credential - we can run in offline mode (they need to have a saved profile available too)\n\t  delete cti.store.variables.lastloginHash;\n      cti.store.variables.workOffline = true;\n      \n      // Issue a manual login expiry - in this case 3 hours\n\tlet expiryTime = new Date((new Date()).getTime() + 180 * 60000);\n      cti.fnHousekeepingCheck();\n\t  cti.store.variables.lastloginTime = new Date();\n      let tempProfile = {};\n      Object.assign(tempProfile, cti.store.variables.lastUserProfile, { expiryTime: expiryTime, token: \"local\" });\n\t  application.setUserProfile(tempProfile);\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"InfoMessage\", \"title\": \"Working offline\", \"text\": \"You are now logged in, but working offline. You will need to connect to WIFI when possible to get the latest data.\" });\n      application.goto(\"Menu\");\n    }\n    else {\n\t  cti.utils.callAction(\"show-notification\", { \"name\": \"ErrorMessage\", \"title\": \"Login failed\", \"text\": \"Please check your WIFI connection and try again.\" });\n    }\n  }\n  else {\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"ErrorMessage\", \"title\": \"Login failed\", \"text\": $data.error.message });\n  }\n  delete cti.store.variables.lastloginHash;\n \n}\n$success(\"Done\");"},"_auto_id_":"3002ab3f-13d3-4e70-8576-61457b9a0aa7","actions":[]}],"name":"LoginResponseHandler"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"application.logout();\n$success();"},"_auto_id_":"ed882fa0-b837-4e32-bbc8-1ae095f45dcf","actions":[]},{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"InfoMessage","title":"You are now back online","text":"Please log in again to continue"},"_auto_id_":"ba959ea6-782c-49e8-8d7f-6a10746bc79c"}],"name":"UnauthorisedHandler"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"console.log('OnActiveShift response flow');\nif (window.debug) {\n\tdebugger;\n}\nif ($data.success) {\n  // The response is written to cti.store.api.shift\n  // cti.store.api.shift.data[0] == employees for the shift\n  // cti.store.api.shift.data[1] == plant for the shift\n  // Don't maintain any state information about people or plant in those objects\n  // as they can get updated mid-shift with updated roster information.\n  cti.fnUpdateShift();\n  application.logEvent(\"Shift information retrieved: \" + cti.store.shift.employees.length + \" employees, \" + cti.store.shift.plant.length + \" plant items\", \"info\");\n}\nelse {\n  debugger;\n\tconsole.log(\"Shift data not updated.\");\n}\n\n$success(\"Done\");"},"_auto_id_":"fbf6b86f-9fe3-462d-b0fe-4041f6538046","actions":[]}],"name":"OnActiveShift"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"\napplication.stopLoader();\ncti.utils.destroyPageData('ChangeMyPassword');\n\n// Was the request successful?\nif ($data.success) {\n  \n  // If the message includes a message to relay to the user, do so\n  let message = $data.response && $data.response.data && $data.response.data.message;\n  if (message) {\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"InfoMessage\", \"title\": \"Information\", \"text\": message });\n  }\n\n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Menu\" });\n}\nelse {\n\tcti.utils.callAction(\"show-notification\", { \"name\": \"ErrorMessage\", \"title\": \"Failed\", \"text\": $data.error.message });\n}\n$success(\"Done\");\n"},"_auto_id_":"6624045f-b000-43e4-b060-49cdef7247d6","actions":[]}],"name":"OnChangePWResponse"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"/*\nActionFlow - OnSaveEventResponse\n*/\nif ($data.success) {\n\tapplication.logEvent(\"Shift status updated\", \"info\");\n}\nelse {\n\tconsole.log(\"Shift data not updated.\");\n}\n$success(\"Done\");"},"_auto_id_":"6bf8bd22-4ed4-4d07-8bc2-dce5927af12b","actions":[]}],"name":"OnSaveEventResponse"}],"dataflows":[],"config":[{"name":"cssRoads","type":"style","item-type":"css","_auto_id_":"157cee3b-6c2a-43c1-a584-89801a5cb30c","content":"ul li {\n\tlist-style-type:none;\n}\na.btn.minimal {\n    color: white!important;\n    font-size: 2em;\n}\nspan.required-asterix.fa.fa-star.ng-scope {\n\tdisplay:none !important;\n}\n.app-summary {\n\ttext-align:center;\n  color:white;\n}\np.version {\n\tcolor:#2880e1;\n  font-size:0.9em;\n  text-align:center;\n}\n\nsection#title_bar {\n    color: white;\n    border: 0;\n    box-shadow: 0 5px 10px rgba(0,0,0,0.19), 0 3px 3px rgba(0,0,0,0.23);\n}\n.logo-image img{\n    display: block;\n    margin: 0 auto;\n    border: 1px solid #fff;\n    height: auto;\n    margin-top: 30px;\n    margin-bottom: 20px;\n}\n\n.page-container {\n\tbackground-color:#222e66;\n}\n.form-group {\n    width: 80%;\n    margin: 0 auto;\n}\n.form-control {\n    height: 65px;\n\tfont-size: 18px;\n  border-radius:10px;\n}\n.input-group-addon:first-child {\n    border-top-left-radius: 10px;\n    border-bottom-left-radius: 10px;\n}\n\n.navbar-default {\n\tbackground-color:#222e66;\n}\n\n.loader-container {\n\tbackground-color:#222e66;\n\tcolor:#fff;\n}\n\nlabel {\n    color: #fff;\n    font-size: 18px;\n}\n\n.navbar .btn {\n    /*color: #fff !important;*/\n    color: #fff;\n    background-color: transparent !important;\n    border: 0;\n    font-size: 20px;\n    margin-left: 15px;\n    margin-right: 15px;\n}\n\n.md-checkbox {\n  color:white;\n}\n.static-item{\n\tbackground-color:#222e66;\n}\n\n.hidden{\n\tdisplay:none;\n}\n.emphasis {\n  font-weight:700;\n}\n.deemphasis {\n  font-size: 0.9em;\n  font-weight:lighter;\n}\n.deemphasis-x {\n  font-size: 0.8em;\n  font-weight:lighter;\n}\n.upper {\n    text-transform: uppercase;\n}\n.align-right {\n  text-align:right;\n}\n.align-center {\n  text-align:center;\n}\n\n.positive {\n  color:green;\n  border:1px solid green;\n}\n.negative {\n  color:red;\n  border:1px solid red;\n}\n\nhr {\n\tmargin-top: 4px !important;\n    margin-bottom: 4px !important;\n}"},{"name":"cssMenu","type":"style","item-type":"css","_auto_id_":"b101d0c4-85c2-43ee-ac67-f421e83b7a35","content":".menu-btn{\n    width: 80%;\n    height: 75px;\n    font-size: 24px;\n    line-height: 60px;\n    text-align: left;\n    background-color: transparent;\n    color: #fff;\n    border: 0;\n    border-bottom: 3px solid;\n}\n.menu-btn:hover{background-color: transparent; color:#fff;}\n\n.menu-btn:after {\n    font-family: 'FontAwesome';\n    margin-right: 10px;\n    font-size: 36px;\n    float: right;\n    color: #fff; \n}\n\n.action-btn {\n\twidth:40%;\n  \tmargin: 0 auto;\n \theight: 60px;\n    border-radius: 10px;\n  \tline-height:45px;\n\tfont-size:18px;\n\tcolor: #222e66;\n}\n.action-btn-default {\n  \tmargin: 0 auto;\n \theight: 60px;\n    border-radius: 10px;\n  \tline-height:45px;\n\tfont-size:18px;\n\tcolor: #222e66;\n}\n.option-change-password:after {\n    content: \"\\f0b1\";\n}\n.option-work:after {\n\tcontent: \"\\f0ad\";\n}\n.option-settings:after {\n    content: \"\\f013\";\n}\n.option-manage-depot:after {\n    content: \"\\f1ad\";\n}\n.option-logout:after {\n    content: \"\\f023\";\n}\n\n\n"},{"name":"InfoMessage","type":"notification","item-type":"app-notification","_auto_id_":"ff8f0dca-fe7c-4192-bc36-6995ca9609f0","options":{"autoDismiss":true,"closeButton":true},"style":"info","title":"Information","actions":[]},{"name":"WarningMessage","type":"notification","item-type":"app-notification","_auto_id_":"0d6571bc-21d6-4c13-bf3a-45358b67375a","options":{"autoDismiss":true,"closeButton":true},"style":"warning","actions":[]},{"name":"GoogleMapping","type":"integration","item-type":"url","_auto_id_":"0e4c5a4b-dcc0-404e-8093-33c0c3087ce7","params":{},"target":"_system","url":"http://maps.google.com/"},{"name":"fnAPI_ShiftStart","type":"scripting","item-type":"function","_auto_id_":"acb5ecba-b867-4aa1-9590-97298bcd4b6e","sync":true,"params":[],"content":"let updates = (cti.store.variables.availabilityUpdates && cti.store.variables.availabilityUpdates.length > 0) ?cti.store.variables.availabilityUpdates.splice(0, cti.store.variables.availabilityUpdates.length) : undefined;\n\napplication.api(\"shift/start\", { \n  method: \"POST\", \n  responseActionFlow: \"OnSaveEventResponse\",\n  payload: {\n    shiftId: cti.store.shift.Id,\n    eventGuid: application.newGuid(),\n    eventTime: application.dbDatetime(new Date()),\n    availability: updates \n  },\n  ttlSeconds: 0 \n});\n"},{"name":"fnAPI_ShiftEnd","type":"scripting","item-type":"function","_auto_id_":"1dbbe1af-ed5b-44ac-b4b8-43cbf715a3dd","sync":true,"params":[],"content":"let updates = (cti.store.variables.availabilityUpdates && cti.store.variables.availabilityUpdates.length > 0) ?cti.store.variables.availabilityUpdates.splice(0, cti.store.variables.availabilityUpdates.length) : undefined;\n\nif (window.debug) {\n\tdebugger;\n}\napplication.api(\"shift/end\", { \n  method: \"POST\", \n  responseActionFlow: \"OnSaveEventResponse\",\n  payload: {\n    shiftId: cti.store.shift.Id,\n    eventGuid: application.newGuid(),\n    eventTime: application.dbDatetime(new Date()),\n    availability: updates\n  },\n  ttlSeconds: 0 \n});"},{"name":"fnHousekeepingCheck","type":"scripting","item-type":"function","_auto_id_":"0ced10da-5f25-45d0-982e-4fa55aafb95a","sync":true,"params":[{"name":"isNewUser","description":"Denotes if the user is different from the last logged in one"}],"content":"/*\nfunction: fnDoHousekeepingCheck\npurpose: If it's the first login of the day, perform any required housekeeping\n*/\n\nvar last = cti.store.variables.lastloginTime;\nvar d = new Date();\n\nif (last && typeof last === \"string\") {\n\tlast = new Date(last);\n}\n\nif (isNewUser) {\n  application.logEvent(\"New user or gang, purging cached data\", \"info\");\n  delete cti.store.shift;\n  delete cti.store.api.shift;\n}\n\n// Full housekeeping required?\nvar doHousekeeping = (!last || (last.getDate() != d.getDate()));\nif (!doHousekeeping) {\n  return false;\n}\n\napplication.logEvent(\"Running full housekeeping, first login today\");\ndelete cti.store.shift;\ndelete cti.store.api.shift;\n"},{"name":"fnIsPasswordAcceptable","type":"scripting","item-type":"function","_auto_id_":"9b19cf7f-ecff-4941-a2c4-e7324805e834","sync":false,"params":[{"name":"password","description":"Password to check against complexity requirements"}],"content":"// fnIsPasswordAcceptable\n\n// Set the complexity requirements for a password to be assigend\nvar required = { length: 8, upper: 1, lower: 1, numeric: 1, special: 1 }\n\n\nvar result = { result: true, upper: 0, lower: 0, numeric: 0, special: 0 }\n\nif(!password || password.length < required.length){\n  return { result: false, err: 'Your password must be at least ' + required.length + ' characters long' }\n}\nfor(var i=0; i<password.length; i++){\n\tif(/[A-Z]/.test(password[i])) result.upper++;\n    else if(/[a-z]/.test(password[i])) result.lower++;\n    else if(/[0-9]/.test(password[i])) result.numeric++;\n    else if(/[!|@|#|$|%|^|&|*|(|)|-|_]/.test(password[i])) result.special++;\n}\n\nif (result.upper >= required.upper && result.lower >= required.lower && result.numeric >= required.numeric && result.special >= required.special) {\n  return result;\n}\nelse {\n  var complexity = [];\n  if (required.upper && required.upper > 0) complexity.push(required.upper + ' UPPERCASE letter'+ ((required.upper>1)?'s':''));\n  if (required.lower && required.lower > 0) complexity.push(required.lower + ' lowercase letter'+ ((required.lower>1)?'s':''));\n  if (required.numeric && required.numeric > 0) complexity.push(required.numeric + ' number'+ ((required.numeric>1)?'s':''));\n  if (required.special && required.special > 0) complexity.push(required.special + ' special character (#?!@*&$)'+ ((required.special>1)?'s':''));\n  return { result: false, err: 'Your password must have at least ' + complexity.join(', ') }\n}\n"},{"name":"fnIsDateEqual","type":"scripting","item-type":"function","_auto_id_":"6d222bd0-b749-4e64-b7ff-73bf1b45be57","sync":true,"params":[{"name":"date1","description":"First date"},{"name":"date2","description":"Second date"}],"content":" var d1 = (typeof date1 === \"string\") ? new Date(date1) : date1;\n var d2 = (typeof date2 === \"string\") ? new Date(date2) : date2;\n return (d1 !== undefined && d2 !== undefined && d1.getFullYear() == d2.getFullYear() && d1.getMonth() == d2.getMonth() && d1.getDate() == d2.getDate());\n"},{"name":"ErrorMessage","type":"notification","item-type":"app-notification","_auto_id_":"a111fed5-6ce1-418f-b35f-231f1820d348","options":{"autoDismiss":true,"closeButton":true},"style":"error","title":"An error occured","actions":[]},{"name":"cssForComponents","type":"style","item-type":"css","_auto_id_":"914a75fc-a5d2-48f3-8cb3-ea25f651031c","content":"/*\nFor the ct-loader component - the activity spinner\n*/\n\nct-loader {\n    display:block;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    z-index:10000;\n    display: none;\n}\nct-loader.active {\n  display: block !important;\n}\nct-loader .spinner {\n    height:40px;\n    width:40px;\n    top:20%;\n    margin:auto;\n    animation: rotation 1.2s infinite linear;\n    border-left:6px solid rgba(255,255,255,.8);\n    border-right:6px solid rgba(255,255,255,.8);\n    border-bottom:6px solid rgba(255,255,255,.8);\n    border-top:6px solid rgba(53,161,223,.8);\n    border-radius:100%;\n}  \nct-loader .header {\n    height:25%;\n}\nct-loader .loading-message {\n    padding:10px 20px;\n    text-align:center;\n    font-size:20px;\n    color:white;\n}\n\n@keyframes rotation {\n    from {transform: rotate(0deg);}\n    to {transform: rotate(359deg);}\n}\n\n\n/*  Styling for context menu */\n\n.menu-container {\n  z-index:50;\n  position:absolute;\n  top:0;\n}\n.menu-container.menu-opened {\n  left:0;\n  width:100%;\n  height:100%;\n    background-color: rgba(0, 0, 0, 0.3);\n    z-index: 999\n}\n.menu-container.menu-opened .menu-opener {\n  display:none;\n}\n.menu-container.menu-opened .menu-content-area {\n  display:initial;\n}\n.menu-container.menu-closed {\n\tright:0;\n  width:40px;\n  height:40px;\n}\n.menu-container.menu-closed .menu-content-area {\n  display:none;\n}\n.menu-container.menu-closed .menu-opener {\n\tdisplay:block;\n\tcolor: white;\n    margin-top: 14px;\n\tcursor: pointer;\n}\n\n.menu-container .menu-content-area {\n}\ncontext-menu .menu-content-area {\n    position: absolute;\n    width: 60vw;\n    height: 100vh;\n    top: 0;\n    right: -60vw;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 1000;\n    -webkit-animation: slide .5s forwards\n}\n@-webkit-keyframes slide {\n    100% {\n        right: 0\n    }\n}\n@keyframes slide {\n    100% {\n        right: 0\n    }\n}\n\ncontext-menu .menu-content-area div {\n    margin: 0;\n    border-bottom: 1px solid white\n}\ncontext-menu .menu-content-area div a,\ncontext-menu .menu-content-area div a:hover {\n    color: white !important;\n    border: none;\n    background-color: transparent !important;\n    width: 100%;\n    padding: 3vh 0;\n    text-align: left;\n    margin-left: 3vw\n}\ncontext-menu .menu-content-area div a span span:before {\n    margin-right: 3vw;\n    width: 8vw;\n    display: inline-block;\n    text-align: center\n}\n\ncontext-menu .btn .fa { padding-right: 1vw; }\n\n\n\n/*\nFor the popup component\n*/\n\nct-popup-box div.popupBG {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.6);\n  z-index: 9999999;\n  padding: 10px;\n}\nct-popup-box div.popupBG div.popupBox {\n  background-color: white;\n  color:slategrey !important;\n  margin: auto;\n  padding:12px;\n}\ndiv.popupBox .form-control {\n    font-size:14px;\n}\ndiv.popupBox .control-label {\n    font-size:14px;\n}\ndiv.popupBox h2 {\n\tfont-size: 24px;\n}\n\n@media (max-width:440px) {\n\tct-popup-box div.popupBG div.popupBox {\n  \t\twidth: 100%;\n\t}\n\t.action-btn-default > span {\n    \twidth: 60px;\n\t}  \n\t.action-btn-default {\n    \twhite-space: normal;\n      width:90px;\n      height:90px;\n\t\tfont-size: 12px;\n    line-height: 15px;\n    padding-top: 15px;\n  }  \n}\n@media (min-width:441px) {\n\tct-popup-box div.popupBG div.popupBox {\n  \t\twidth: 420px;\n\t}\n}\n\nct-popup-box .md-checkbox-container {\n  width: 100%;\n}\nct-popup-box .checkbox-element {\n  margin: 0;\n  padding: 0;\n}\nct-popup-box .md-checkbox {\n  padding: 6px;\n}\nct-popup-box .md-button-container {\n  width: 100%;\n  padding-top: 16px!important;\n}\n/*\nct-popup-box .md-button-container a,\nct-popup-box .md-button-container a:hover {\n  width: 180px;\n}\n*/\nct-popup-box md-content {\n  text-align: center;\n  /*\n  padding: 3vh 4vw 0;\n  */\n}\nct-popup-box .form-group {\n  padding-bottom: 0;\n}\nct-popup-box md-question > div {\n  padding: 0 20px!important;\n}\nct-popup-box label {\n  color:slategrey !important;\n}\n\n.flexbox-container .navbar-default.row-item:last-child {\n    background-color: #fff !important;\n    color:black;\n    margin-top: 10px;\n}\n.popup-btn {\n  \tmargin: 0 auto;\n \theight: 60px;\n    border-radius: 10px;\n    border:1px solid silver !important;\n  \tline-height:45px;\n\tfont-size:14px !important;\n\tcolor: #222e66 !important;\n}\n.popup-btn:hover {\n    border:1px solid #35A1DF !important;\n\tcolor: #35A1DF !important;\n}\n\n"},{"name":"cssInfinityOverrides","type":"style","item-type":"css","_auto_id_":"3ac2de58-191f-424d-aee6-6d0658569ae3","content":".static-item{\n  border:0;\n  flex:initial !important;\n}\n.static-item .content-block {\n  margin-bottom:8px;\n}\n\nsection.scrollable-item {\n    overflow-y: auto;\n}\n.md-list>.main.scrollable {\n    overflow-y: hidden;\n}\nsection#title_bar > div:first-child {\n    position: absolute;\n    left: 0;\n    width: 2em;\n}\nsection#title_bar > div:last-child {\n    position: absolute;\n    right: 2em;\n    width: 2em;\n}\n\n\n.has-error .checkbox, .has-error .checkbox-inline, .has-error .control-label, .has-error .help-block, .has-error .radio, .has-error .radio-inline, .has-error.checkbox label, .has-error.checkbox-inline label, .has-error.radio label, .has-error.radio-inline label {\n    color: white;\n}\n.has-success .checkbox, .has-success .checkbox-inline, .has-success .control-label, .has-success .help-block, .has-success .radio, .has-success .radio-inline, .has-success.checkbox label, .has-success.checkbox-inline label, .has-success.radio label, .has-success.radio-inline label {\n    color: white;\n}"},{"name":"cssStatic","type":"style","item-type":"css","_auto_id_":"86073d57-0c1a-4a8f-9947-50594f3aaf91","content":".static-header {\n  background-color:white;\n  color:black;\n}\n.static-header.work-item {\n  padding:8px 0 0 0 !important;\n  margin-bottom: 0 !important;\n  font-size:1.2em;\n}\n.static-header-toolbar {\n  background-color:white;\n  color:black;\n  flex-direction:row !important;\n  padding:0 10px !important;\n}\n.static-header-buttonbar {\n  background-color:white;\n  color:black;\n  flex-direction:row !important;\n  padding:0 10px 0 38px !important;\n}\n.static-header-toolbar .action-btn-default,\n.static-header-buttonbar .action-btn-default {\n    margin-right: 10px;\n}\n.properties-and-values {\n  color:white;\n  display:flex;\n  vertical-align:middle;\n  min-height:28px;\n  line-height:28px;\n}\n.properties-and-values div {\n  padding:4px;\n}\n.properties-and-values .property-name {\n  flex: 0 0 25%;\n  font-size:0.9em;\n  font-weight:lighter;\n}\n.properties-and-values .property-value {\n    flex: 0 0 65%;\n  font-weight:700;\n}\n\n.header-section {\n    margin-left: 38px;\n    margin-top: 6px;\n}\n.detail-section {\n  margin-left:38px;\n}\n\n\n/*\nMapping area\n*/\n.mapcontainer {\n  border:1px slategrey solid;\n  content:\"Loading map...\";\n}\n\n@media (max-width:440px) {\n\t.mapcontainer {\n    \twidth: 320px;\n    \theight: 240px;\n    }\n}\n@media (min-width:441px) {\n\t.mapcontainer {\n    \twidth: 420px;\n\t    height: 360px;\n    }\n}\n\n"},{"name":"cssList","type":"style","item-type":"css","_auto_id_":"f347ec39-87f7-4fa3-8314-449398ba51d5","content":".list-host {\n  background-color:white;\n  /*\n  border-top: #35A1DF 2px solid;\n  */\n}\n.list-host.no-top-padding {\n  padding-top:0 !important;\n}\n.list-host.no-padding {\n  padding:0 !important;\n}\n.list-host ul {\n  padding-left:0;\n}\nmd-list .content-block {\n  margin-bottom:8px;\n}\n\n.pagination>.active>a, .pagination>.active>a:focus, .pagination>.active>a:hover, .pagination>.active>span, .pagination>.active>span:focus, .pagination>.active>span:hover {\n    background-color: #35A1DF;\n}\n\n.header-card {\n  border:none !important;\n}\n.list-card {\n  border-radius:8px;\n  border:1px slategrey solid;\n  width:100%;\n  display:flex;\n  font-size: 0.9em;\n  min-height:48px;\n}\n.list-card.large {\n  min-height:80px;\n}\n.list-card .column-icon {\n  flex: 0 0 38px;\n  background-color: #35A1DF;\n  color: white;\n  text-align:center;\n  border-bottom-left-radius: 8px;\n  border-top-left-radius: 8px;\n  padding-top:4px;\n}\n.list-card .column-icon-null {\n  flex: 0 0 38px;\n  color: white;\n  border-bottom-left-radius: 8px;\n  border-top-left-radius: 8px;\n}\n.list-card .column {\n  padding:4px;\n}\n.list-card .column-20pc {\n  flex: 0 0 20%;\n}\n.list-card .column-30pc {\n  flex: 0 0 30%;\n}\n.list-card .column-60pc {\n  flex: 0 0 60%;\n}\n.list-card .column-3 {\n}\n\n/*\nIcon and color indication for log entries\n*/\n.indicator-debug i:after {\n  content: \"\\f13a\";\n}\n.indicator-info i:after, .indicator-information i:after {\n  content: \"\\f05a\";\n}\n.indicator-warn i:after, .indicator-warning i:after {\n  content: \"\\f071\";\n}\n.indicator-error i:after {\n  content: \"\\f06a\";\n}\n\n.indicator-debug {\n  opacity:0.4;\n}\n.indicator-info i, .indicator-information i {\n  color:white;\n}\n.indicator-warn i, .indicator-warning i {\n  color:yellow;\n}\n.indicator-error {\n  background-color: red !important;\n}\n\n\n.shift-availability {\n  text-transform:capitalize;\n  font-weight:700;\n}\n\n.shift-available i:after, .shift-Available i:after {\n  content: \"\\f058\";\n}\n.shift-unavailable i:after, .shift-Unavailable i:after {\n  content: \"\\f057\";\n}\n.shift-unknown i:after, .shift-Unknown i:after {\n  content: \"\\f059\";\n}\n.shift-available, .shift-Available {\n  border-right:green 3px solid;\n  background-color:#e5f2e5 !important;\n}\n.shift-unavailable, .shift-Unavailable {\n  border-right:red 3px solid;\n  background-color:#f2e5e5 !important;\n}\n.shift-unknown, .shift-Unknown {\n  background-color:white !important;\n}\n.shift-unknown i, .shift-Unknown i {\n  color:yellow;\n}\n\n/*\nWorks instruction stuff\n*/\n.card-row {\n  margin-bottom:4px;\n}\n.card-row.large {\n  font-size:1.1em;\n}\n.card-dd {\n \tfont-size:1.6em;\n    text-align: right;\n    display: block;\n    margin-right: 6px;\n    color: slategray;\n}\n.card-mon {\n\tfont-size: 0.9em;\n    text-align: right;\n    display: block;\n    color: slategray;\n    margin-right: 6px;\n}\n\n.work-indicator-new {\n  border-right:orange 3px solid;\n  background-color:#fff !important;\n}\n.work-indicator-accepted {\n  border-right:green 3px solid;\n  background-color:#fff !important;\n}\n.work-indicator-complete {\n  border-right:green 3px solid;\n  background-color:#e5f2e5 !important;\n}\n.work-indicator-rejected {\n  border-right:red 3px solid;\n  background-color:#f2e5e5 !important;\n}\n.work-indicator-suspended {\n  border-right:#E65D8C 3px solid;\n  background-color:#fff !important;\n}\n"},{"name":"jsRoadsGangFramework","type":"scripting","item-type":"js-asset","_auto_id_":"b6841cc2-0821-400d-94b6-3206e4810788","fileName":"roads-gang-application.js"},{"name":"fnUpdateShift","type":"scripting","item-type":"function","_auto_id_":"d88239ed-13d5-4f50-806e-1d9a5f8d8c8a","sync":true,"params":[],"content":"/*\nfnUpdateShift\nInitialise or update our shift management data objects\n*/\n\nlet employees = cti.store.api.shift.data[1];\nlet plant = cti.store.api.shift.data[2];\nlet work = cti.store.api.shift.data[3];\n\nlet actionedItems = [];\n\nif (!cti.store.shift) {\n  cti.store.shift = {}\n  Object.assign(cti.store.shift, cti.store.api.shift.data[0][0]);\n}\n\n\n// PROCESS EMPLOYEES\nif (!cti.store.shift.employees) {\n  cti.store.shift.employees = []\n  Object.assign(cti.store.shift.employees, employees);\n}\nelse {\n  // Check if we have had any employees removed or added...\n  employees.forEach(e => {\n    // See if we already have a local record for this employee?\n    let existing = cti.store.shift.employees.find(x => x.EmployeeId == e.EmployeeId);\n    if (!existing) {\n      actionedItems.push(e.Name);\n      cti.store.shift.employees.push(e);\n    }\n  });\n  if (actionedItems.length > 0) {\n    application.infoMessage('New team members assigned: ' + actionedItems.join(', ', 'Shift Information'));\n    actionedItems.splice(0, actionedItems.length);\n  }\n\n  // If we have employees locally, but not in the new payload, they've been removed...\n  cti.store.shift.employees.forEach(e => {\n    let existing = employees.findIndex(x => x.EmployeeId == e.EmployeeId);\n    if (existing == -1) {\n      // Local employee isn't there, needs removing\n      actionedItems.push(e.Name);\n      cti.store.shift.employees.splice(existing, 1);\n    }\n  });\n  // Message display if we detect removed team members\n  if (actionedItems.length > 0) {\n    application.infoMessage('Team members removed from gang: ' + actionedItems.join(', ', 'Shift Information'));\n    actionedItems.splice(0, actionedItems.length);\n  }\n}\n\n\n// PROCESS PLANT\nif (!cti.store.shift.plant) {\n  cti.store.shift.plant = []\n  Object.assign(cti.store.shift.plant, plant);\n}\nelse {\n  plant.forEach(e => {\n    let existing = cti.store.shift.plant.find(x => x.PlantId == e.PlantId);\n    if (!existing) {\n      cti.store.shift.plant.push(e);\n    }\n  });\n\n  cti.store.shift.plant.forEach(e => {\n    let existing = plant.findIndex(x => x.PlantId == e.PlantId);\n    if (existing == -1) {\n      cti.store.shift.plant.splice(existing, 1);\n    }\n  });\n}\n\n\n// PROCESS WORKS INSTRUCTIONS\nif (!cti.store.shift.work) {\n  cti.store.shift.work = []\n  Object.assign(cti.store.shift.work, work);\n}\nelse {\n  // Any new works instruction given by the API?\n  work.forEach(e => {\n    let existing = cti.store.shift.work.find(x => x.Id == e.Id);\n    if (!existing) {\n      cti.store.shift.work.push(e);\n    }\n  });\n  \n  // Any works orders removed or modified? eg cancelled at HO\n  let removeItems = [];\n  cti.store.shift.work.forEach(e => {\n    let existing = work.findIndex(x => x.Id == e.Id);\n    // If our local item is not in the API results, it needs to be removed from local\n    if (existing == -1) {\n      removeItems.push(e.Id);\n    }\n    else if (work[existing].version != e.version) {\n      console.log('WO has been modified at the server, need to refresh fields on local copy');\n      for (var k in work[existing]) {\n        e[k] = work[existing][k];\n      }\n    }\n  });\n  \n  // Remove any WOs we have locally that should no longer be present (what if we're active on one)\n  if (removeItems.length > 0) {\n\tremoveItems.forEach(e => {\n\t  let itemIndex = cti.store.shift.work.findIndex(x => x.Id == e);\n      cti.store.shift.work.splice(itemIndex, 1);\n    });\n    console.log('WO notified as deleted at server, removed ' + removeItems.length);\n  }\n}\n\ndelete cti.store.api.shift.data;\n// Here is the end of the function"},{"name":"fnSaveShiftEvent","type":"scripting","item-type":"function","_auto_id_":"56f1094f-5420-4113-abad-f0e2f4dc751c","sync":true,"params":[{"name":"event","description":"Event type label"},{"name":"worksInstructionId"}],"content":"application.api(\"shift/event\", { \n  method: \"POST\", \n  responseActionFlow: \"OnSaveEventResponse\",\n  payload: {\n    shiftId: cti.store.shift.Id,\n    event: event,\n    eventGuid: application.newGuid(),\n    eventTime: new Date(),\n\tworksInstructionId: worksInstructionId\n  },\n  ttlSeconds: 0 \n});\n\n"},{"name":"fnSaveCurrentItemStatus","type":"scripting","item-type":"function","_auto_id_":"f8b1e6f7-560f-404a-ac6b-be9f24263684","sync":true,"params":[{"name":"status","description":"New status for the job"},{"name":"reason","description":"Reason info - for instance why job rejected"}],"content":"/*\nParams expected by API\n{\n                \"shiftId\": request.body.shiftId,\n                \"event\": request.body.event,\n                \"eventGuid\": request.body.eventGuid,\n                \"eventTime\": request.body.eventTime,\n                \"worksInstructionId\": request.body.worksInstructionId,\n                \"reason\": request.body.reason\n}\n*/\nlet updates = (cti.store.variables.availabilityUpdates && cti.store.variables.availabilityUpdates.length > 0) ?cti.store.variables.availabilityUpdates.splice(0, cti.store.variables.availabilityUpdates.length) : undefined;\n\napplication.api(\"shift/updateactivity\", { \n  method: \"POST\", \n  payload: {\n    shiftId: cti.store.shift.Id,\n    event: status,\n    eventGuid: application.newGuid(),\n    eventTime: application.dbDatetime(new Date()),\n\tworksInstructionId: cti.store.current.Id,\n    reason: reason,\n    availability: updates \n  },\n  ttlSeconds: 0 \n});\n\ncti.store.current.Status = status;\n"},{"name":"fnSaveAvailability","type":"scripting","item-type":"function","_auto_id_":"e8930305-217c-48d5-afc1-56af522b0c46","sync":true,"params":[],"content":"/*\nfnSaveAvailability\n*/\nif (!cti.store.variables.availabilityUpdates || cti.store.variables.availabilityUpdates.length == 0) {\n\treturn false; // Nothing to do\n}\n\nlet updates = cti.store.variables.availabilityUpdates.splice(0, cti.store.variables.availabilityUpdates.length);\n\napplication.api(\"shift/availability\", { \n  method: \"POST\", \n  payload: updates,\n  ttlSeconds: 0 \n});\n"},{"name":"fnRequestEndShift","type":"scripting","item-type":"function","_auto_id_":"6695154c-d539-4cbe-81bb-cada640ee857","sync":true,"params":[],"content":"cti.store.variables.endShiftMessage = \"Are you sure you want to end the shift now?\";\ncti.store.variables.endShiftTime = new Date();\n\n// TODO Based on rules, we'll decide if it appropriate to display a popup or a warning dialog etc\nvar popup = document.getElementById(\"ppEndShift\");\nif (popup !== undefined && popup !== null)\n\tpopup.toggle();\n\n"},{"name":"fnExtractDynamicContent","type":"scripting","item-type":"function","_auto_id_":"6ca31005-e55b-4c6f-945e-a92a91a20860","sync":true,"params":[{"name":"content"}],"content":"/*\nfnExtractDynamicContent\nTakes some encoded content and generate an array of decoded elements from it\n*/\nif (!content || !window.DOMParser) {\n  return undefined;\n}\n\nvar parser = new DOMParser();\ntry {\n\tvar el = parser.parseFromString(content, \"text/xml\");\n  \n}\ncatch (e) {\n  return undefined;\n}"},{"name":"fnSetCurrentJob","type":"scripting","item-type":"function","_auto_id_":"fd697f76-2a8a-4259-bfba-19852599d082","sync":true,"params":[{"name":"item","description":"The selected job"}],"content":"cti.store.current = item;\ncti.store.current.canReturn = true;\ncti.store.current.canAccept = true;\ncti.store.current.canReject = true;\n\ncti.store.current.displaySorData = cti.store.current.sorData ? atob(cti.store.current.sorData) : '';\ncti.store.current.displayExtraData = cti.store.current.extraData ? atob(cti.store.current.extraData) : '';\n\napplication.goto(\"WorkItem\");"},{"name":"fnOnWillAutoSync","type":"scripting","item-type":"function","_auto_id_":"f0a166c7-35f1-4eb3-85ba-151eaf294384","sync":true,"params":[],"content":"if (!cti.store.shift) {\n  // This only serves to refresh an already existing shift\n  return false;\n}\n\nconsole.log(\"trace:: OnWillAutoSync processing, refresh the shift data\");\n\nlet profile = application.getUserProfile();\napplication.api(\"getactiveshift/\" + profile.gangId, { \n  method: \"GET\", \n  responseActionFlow: \"OnActiveShift\", \n  ttlSeconds: -1, \n  apiStoreKey: \"shift\",\n  queueAsPending: true,\n  noDuplicate: true\n});\n"},{"name":"fnWorkMapReady","type":"scripting","item-type":"function","_auto_id_":"9037ac98-cc91-4fb5-a04f-6d807cca867f","sync":true,"params":[],"content":"var myLatlng = new google.maps.LatLng(cti.store.current.lat, cti.store.current.lon);\nvar e = document.getElementById('mapPanel');\nif (!e) {\n  application.logEvent(\"Map panel not available for rendering map view\", \"warning\");\n  return false;\n}\ne.innerHTML = '<div id=\"mapcontainer\" class=\"mapcontainer\"></div>';\n\n\nvar map = new google.maps.Map(document.getElementById('mapcontainer'), {\n  zoom: 18,\n  center: myLatlng,\n  mapTypeId: 'hybrid'\n});\n\n// Place a draggable marker on the map\nvar marker = new google.maps.Marker({\n  position: myLatlng,\n  map: map,\n  animation: google.maps.Animation.DROP\n});\n"},{"name":"fnOpenStreetMapReady","type":"scripting","item-type":"function","_auto_id_":"48f6955b-b640-4882-937b-b970edb581ed","sync":true,"params":[],"content":"var lat = cti.store.current.lat\nvar lon = cti.store.current.lon;\nvar e = document.getElementById('mapPanel');\nif (!e) {\n  application.logEvent(\"Map panel not available for rendering map view\", \"warning\");\n  return false;\n}\ne.innerHTML = '<div id=\"mapcontainer\" class=\"mapcontainer\"></div>';\n\nvar map = L.map('mapcontainer').setView([lat, lon], 11);\n\nL.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors',\n  maxZoom: 18,\n}).addTo(map);\n\n// add marker to the map\nvar marker = L.marker([lat, lon]).addTo(map);\n\nvar markerText = '<b>' + (cti.store.current.SummaryHeader || 'Works Order') + '</b><br />' + (cti.store.current.SummaryLocation || '(location summary not available)');\n\n// add popup to the marker\nmarker.bindPopup(markerText).openPopup();\n"}],"components":[{"name":"Loader","description":"Activity loader component","icon":"fa-puzzle-piece","_auto_id_":"5a8e37ef-8425-49ff-ae8e-a8ef7d9ca6fe","tagName":"ct-loader","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"message","description":"A message to display whilst the spinner is showing","type":"string","enum":null,"required":false}]},"userConfig":{},"valid":true,"files":{"original":"Loader.js","transpiled":"Loader.output.js"}},{"name":"ContextMenu","description":"","icon":"fa-puzzle-piece","_auto_id_":"e677c899-4008-4d70-8601-452873cad5bc","tagName":"context-menu","type":"web-component","format":"javascript","typeVersion":"1","annotations":{},"userConfig":{},"valid":true,"files":{"original":"ContextMenu.js","transpiled":"ContextMenu.output.js"}},{"name":"PopupBox","description":"","icon":"fa-puzzle-piece","_auto_id_":"71baf404-4000-4d59-8b16-d8cbc7f4ea1f","tagName":"ct-popup-box","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"id","description":"","type":"string","enum":null,"required":true}],"functions":[{"name":"toggle","description":"Toggles the menu opened and closed based on the value\nof the this.opened property (initially set to false)","params":[{"name":"containerid","description":"id of container the popup is in","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"PopupBox.js","transpiled":"PopupBox.output.js"}}],"icondata":"SLCRoadsLiveIcon.png","jwt":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBfaWQiOiJlMDZhYTY5ZS1mN2YwLTRjNWEtYTllYi00YjE4ZTY4Yzg4N2MiLCJhcHBfbmFtZSI6IlNMQ1JvYWRzR2FuZyIsImJ1aWxkX2lkIjoiN2U1NDAzZGEtYTRjYS00NWFlLWE2ZGItYmI1MGQ1YmMxZjNkIiwiY2xpZW50X2lkIjoiOTU2NGFmYTAtODlkYS00ZjE0LTliNjUtYWQ2ZGI5ODhkYzA0IiwiY2xpZW50X3NlY3JldCI6ImEzaFVORTlXS3pKSFdVRnBOVWxOZGt0RFVEWlVkejA5IiwiZXhwIjoxODg0Mzg0MDAwLCJmcmVxdWVuY3kiOjIxNjAwMDAwMCwiaGFzaCI6IjAxMDEwOGZiYTBmMjUwMDBkYzlmNmIxNzVkNWUyMGQ3MWU0ZWRhZTY2M2E5ZTA2M2RlOTQ3MzRjMTY5NzM3ZGQiLCJsaWNfZXhwIjoxODgxNzkyMDAwLCJscF9pZCI6IjdjOWU1NmIyLTg5ZjMtNGEzYi04MDZhLTQzZGZkOGJmZmJhNCIsInBhY2thZ2VfaWQiOiJnb3Yuc291dGhsYW5hcmtzaGlyZS5tb2JpbGUucm9hZHNnYW5nIiwicmVmcmVzaF90b2tlbiI6Ik0xaHFWMEo1SzJwaGNsWlFjbEkyZFhJM2RFTllUWGhrWWtGSVoyUlJUMEpCVFcxTGIyeGxTaTgwY3owPSIsInR5cGUiOiJmdWxsIiwiaWF0IjoxNTc0MzM3MzczfQ.qJhizsBNZutBAckraoAMs6jEoPekcSRRfVLYt5KvFh62kobvciywbyiV1Xj9RFMvsQTUEwy27vVJxV-LZikDqvLaKebz7zpdL9QySBvFbUwpuATzIocmykhGEEYo1-n9hjFLozxGsAa7oSYHIeVAuZhJ-C6y1-H0NJlGOa52vHB_PtInt9XsIoOKEvTB7lkrVXZAPfAvpxhtMkAE0nIR15a_g3zBPM7UxcuMhcjmiQYQ1V78zaU_k6rC3pppYwJuVL0Bb__r2vGOUUz5ElV-VpbXQ9OfIMERfs2hdy8J5N8LhrNRXRSma2PAE6Uz1i3Gpgavr5s9P4mW7LcNFJs2ZQ","buildId":"7e5403da-a4ca-45ae-a6db-bb50d5bc1f3d","hostContext":0}